# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by
[Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security
review. It should not be relied upon for any purpose other than to assist in the identification of potential security
vulnerabilities.

# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Unprotected initializer](#h-1-unprotected-initializer)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: Missing checks for `address(0)` when assigning values to address state variables](#l-2-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [L-3: `public` functions not used internally could be marked `external`](#l-3-public-functions-not-used-internally-could-be-marked-external)
  - [L-4: Define and use `constant` variables instead of using literals](#l-4-define-and-use-constant-variables-instead-of-using-literals)
  - [L-5: Event is missing `indexed` fields](#l-5-event-is-missing-indexed-fields)
  - [L-6: Modifiers invoked only once can be shoe-horned into the function](#l-6-modifiers-invoked-only-once-can-be-shoe-horned-into-the-function)
  - [L-7: Large literal values multiples of 10000 can be replaced with scientific notation](#l-7-large-literal-values-multiples-of-10000-can-be-replaced-with-scientific-notation)
  - [L-8: Internal functions called only once can be inlined](#l-8-internal-functions-called-only-once-can-be-inlined)
  - [L-9: Unused Custom Error](#l-9-unused-custom-error)
  - [L-10: Potentially unused `private` / `internal` state variables found.](#l-10-potentially-unused-private--internal-state-variables-found)
  - [L-11: Uninitialized local variables.](#l-11-uninitialized-local-variables)
  - [L-12: Costly operations inside loops.](#l-12-costly-operations-inside-loops)

# Summary

## Files Summary

| Key         | Value |
| ----------- | ----- |
| .sol Files  | 24    |
| Total nSLOC | 2170  |

## Files Details

| Filepath                                                   | nSLOC    |
| ---------------------------------------------------------- | -------- |
| src/EOFeedManager.sol                                      | 164      |
| src/EOFeedVerifier.sol                                     | 193      |
| src/EOTwitterFeedManager.sol                               | 128      |
| src/adapters/EOFeedAdapter.sol                             | 102      |
| src/adapters/EOFeedAdapterV2.sol                           | 98       |
| src/adapters/EOFeedRegistryAdapter.sol                     | 4        |
| src/adapters/EOFeedRegistryAdapterBase.sol                 | 172      |
| src/adapters/EOFeedRegistryAdapterClone.sol                | 4        |
| src/adapters/factories/EOFeedFactoryBase.sol               | 5        |
| src/adapters/factories/EOFeedFactoryBeacon.sol             | 17       |
| src/adapters/factories/EOFeedFactoryClone.sol              | 16       |
| src/adapters/interfaces/IEOFeedAdapter.sol                 | 30       |
| src/adapters/interfaces/IEOFeedAdapterV2.sol               | 29       |
| src/adapters/interfaces/IEOFeedRegistryAdapter.sol         | 37       |
| src/common/BLS.sol                                         | 895      |
| src/examples/EoracleConsumerExampleFeedAdapter.sol         | 17       |
| src/examples/EoracleConsumerExampleFeedManager.sol         | 20       |
| src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol | 21       |
| src/interfaces/Errors.sol                                  | 24       |
| src/interfaces/IBLS.sol                                    | 24       |
| src/interfaces/IEOFeedManager.sol                          | 29       |
| src/interfaces/IEOFeedVerifier.sol                         | 42       |
| src/interfaces/IEOTwitterFeedManager.sol                   | 72       |
| src/libraries/Denominations.sol                            | 27       |
| **Total**                                                  | **2170** |

## Issue Summary

| Category | No. of Issues |
| -------- | ------------- |
| High     | 1             |
| Low      | 12            |

# High Issues

## H-1: Unprotected initializer

Consider protecting the initializer functions with modifiers.

<details><summary>3 Found Instances</summary>

- Found in src/adapters/factories/EOFeedFactoryBase.sol [Line: 5](src/adapters/factories/EOFeedFactoryBase.sol#L5)

  ```solidity
      function __EOFeedFactory_init(address impl, address) internal virtual;
  ```

- Found in src/adapters/interfaces/IEOFeedAdapter.sol [Line: 11](src/adapters/interfaces/IEOFeedAdapter.sol#L11)

  ```solidity
      function initialize(
  ```

- Found in src/adapters/interfaces/IEOFeedAdapterV2.sol [Line: 11](src/adapters/interfaces/IEOFeedAdapterV2.sol#L11)

  ```solidity
      function initialize(
  ```

</details>

# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious
updates or drain funds.

<details><summary>12 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 108](src/EOFeedManager.sol#L108)

  ```solidity
      function setFeedVerifier(address feedVerifier) external onlyOwner onlyNonZeroAddress(feedVerifier) {
  ```

- Found in src/EOFeedManager.sol [Line: 117](src/EOFeedManager.sol#L117)

  ```solidity
      function setFeedDeployer(address feedDeployer) external onlyOwner onlyNonZeroAddress(feedDeployer) {
  ```

- Found in src/EOFeedManager.sol [Line: 127](src/EOFeedManager.sol#L127)

  ```solidity
      function setSupportedFeeds(uint256[] calldata feedIds, bool[] calldata isSupported) external onlyOwner {
  ```

- Found in src/EOFeedManager.sol [Line: 147](src/EOFeedManager.sol#L147)

  ```solidity
      function whitelistPublishers(address[] calldata publishers, bool[] calldata isWhitelisted) external onlyOwner {
  ```

- Found in src/EOFeedManager.sol [Line: 197](src/EOFeedManager.sol#L197)

  ```solidity
      function setPauserRegistry(address pauserRegistry) external onlyOwner onlyNonZeroAddress(pauserRegistry) {
  ```

- Found in src/EOFeedVerifier.sol [Line: 126](src/EOFeedVerifier.sol#L126)

  ```solidity
      function setNewValidatorSet(Validator[] calldata newValidatorSet) external onlyOwner {
  ```

- Found in src/EOFeedVerifier.sol [Line: 162](src/EOFeedVerifier.sol#L162)

  ```solidity
      function setFeedManager(address feedManager) external onlyOwner {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 63](src/EOTwitterFeedManager.sol#L63)

  ```solidity
      function setFeedVerifier(address feedVerifier) external onlyOwner onlyNonZeroAddress(feedVerifier) {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 72](src/EOTwitterFeedManager.sol#L72)

  ```solidity
      function setSupportedFeeds(uint256[] calldata feedIds, bool[] calldata isSupported) external onlyOwner {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 82](src/EOTwitterFeedManager.sol#L82)

  ```solidity
      function whitelistPublishers(address[] calldata publishers, bool[] calldata isWhitelisted) external onlyOwner {
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 72](src/adapters/EOFeedRegistryAdapterBase.sol#L72)

  ```solidity
      function setFeedManager(address feedManager) external onlyOwner onlyNonZeroAddress(feedManager) {
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 134](src/adapters/EOFeedRegistryAdapterBase.sol#L134)

  ```solidity
      function removeFeedAdapter(address base, address quote) external onlyOwner {
  ```

</details>

## L-2: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

<details><summary>18 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 99](src/EOFeedManager.sol#L99)

  ```solidity
          _feedVerifier = IEOFeedVerifier(feedVerifier);
  ```

- Found in src/EOFeedManager.sol [Line: 100](src/EOFeedManager.sol#L100)

  ```solidity
          _pauserRegistry = IPauserRegistry(pauserRegistry);
  ```

- Found in src/EOFeedManager.sol [Line: 101](src/EOFeedManager.sol#L101)

  ```solidity
          _feedDeployer = feedDeployer;
  ```

- Found in src/EOFeedManager.sol [Line: 109](src/EOFeedManager.sol#L109)

  ```solidity
          _feedVerifier = IEOFeedVerifier(feedVerifier);
  ```

- Found in src/EOFeedManager.sol [Line: 118](src/EOFeedManager.sol#L118)

  ```solidity
          _feedDeployer = feedDeployer;
  ```

- Found in src/EOFeedManager.sol [Line: 198](src/EOFeedManager.sol#L198)

  ```solidity
          _pauserRegistry = IPauserRegistry(pauserRegistry);
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 56](src/EOTwitterFeedManager.sol#L56)

  ```solidity
          _feedVerifier = IEOFeedVerifier(feedVerifier);
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 64](src/EOTwitterFeedManager.sol#L64)

  ```solidity
          _feedVerifier = IEOFeedVerifier(feedVerifier);
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 64](src/adapters/EOFeedRegistryAdapterBase.sol#L64)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 73](src/adapters/EOFeedRegistryAdapterBase.sol#L73)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/adapters/factories/EOFeedFactoryBeacon.sol [Line: 23](src/adapters/factories/EOFeedFactoryBeacon.sol#L23)

  ```solidity
          _beacon = address(new UpgradeableBeacon(impl, initialOwner));
  ```

- Found in src/adapters/factories/EOFeedFactoryClone.sol [Line: 22](src/adapters/factories/EOFeedFactoryClone.sol#L22)

  ```solidity
          _feedImplementation = impl;
  ```

- Found in src/examples/EoracleConsumerExampleFeedAdapter.sol
  [Line: 11](src/examples/EoracleConsumerExampleFeedAdapter.sol#L11)

  ```solidity
          _feedAdapter = IEOFeedAdapter(feedAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedAdapter.sol
  [Line: 15](src/examples/EoracleConsumerExampleFeedAdapter.sol#L15)

  ```solidity
          _feedAdapter = IEOFeedAdapter(feedAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedManager.sol
  [Line: 11](src/examples/EoracleConsumerExampleFeedManager.sol#L11)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/examples/EoracleConsumerExampleFeedManager.sol
  [Line: 15](src/examples/EoracleConsumerExampleFeedManager.sol#L15)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol
  [Line: 12](src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol#L12)

  ```solidity
          _feedRegistryAdapter = IEOFeedRegistryAdapter(feedRegistryAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol
  [Line: 16](src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol#L16)

  ```solidity
          _feedRegistryAdapter = IEOFeedRegistryAdapter(feedRegistryAdapter);
  ```

</details>

## L-3: `public` functions not used internally could be marked `external`

Instead of marking a function as `public`, consider marking it as `external` if it is not used internally.

<details><summary>1 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 866](src/common/BLS.sol#L866)

  ```solidity
      function neg(uint256[2] memory p) public pure returns (uint256[2] memory) {
  ```

</details>

## L-4: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout
the contract.

<details><summary>20 Found Instances</summary>

- Found in src/EOFeedVerifier.sol [Line: 88](src/EOFeedVerifier.sol#L88)

  ```solidity
          _minNumOfValidators = 3;
  ```

- Found in src/EOFeedVerifier.sol [Line: 290](src/EOFeedVerifier.sol#L290)

  ```solidity
          if (aggVotingPower <= ((2 * _totalVotingPower) / 3)) revert InsufficientVotingPower();
  ```

- Found in src/EOFeedVerifier.sol [Line: 342](src/EOFeedVerifier.sol#L342)

  ```solidity
          uint256 byteNumber = index / 8;
  ```

- Found in src/EOFeedVerifier.sol [Line: 344](src/EOFeedVerifier.sol#L344)

  ```solidity
          uint8 bitNumber = uint8(index % 8);
  ```

- Found in src/common/BLS.sol [Line: 754](src/common/BLS.sol#L754)

  ```solidity
          uint256[4] memory bnAddInput;
  ```

- Found in src/common/BLS.sol [Line: 774](src/common/BLS.sol#L774)

  ```solidity
          uint256[4] calldata pubkey,
  ```

- Found in src/common/BLS.sol [Line: 799](src/common/BLS.sol#L799)

  ```solidity
          uint256[4] calldata pkG2
  ```

- Found in src/common/BLS.sol [Line: 823](src/common/BLS.sol#L823)

  ```solidity
          uint256[4] memory input;
  ```

- Found in src/common/BLS.sol [Line: 847](src/common/BLS.sol#L847)

  ```solidity
          uint256[3] memory input;
  ```

- Found in src/common/BLS.sol [Line: 887](src/common/BLS.sol#L887)

  ```solidity
          uint256[4] memory a2,
  ```

- Found in src/common/BLS.sol [Line: 889](src/common/BLS.sol#L889)

  ```solidity
          uint256[4] memory b2,
  ```

- Found in src/common/BLS.sol [Line: 960](src/common/BLS.sol#L960)

  ```solidity
          bytes memory msg0 = new bytes(32 + t0 + 64 + 4);
  ```

- Found in src/common/BLS.sol [Line: 982](src/common/BLS.sol#L982)

  ```solidity
          t0 = 32 + 34;
  ```

- Found in src/common/BLS.sol [Line: 1059](src/common/BLS.sol#L1059)

  ```solidity
          a0 = addmod(a0, 4, N);
  ```

- Found in src/common/BLS.sol [Line: 1072](src/common/BLS.sol#L1072)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/common/BLS.sol [Line: 1087](src/common/BLS.sol#L1087)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/common/BLS.sol [Line: 1105](src/common/BLS.sol#L1105)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/interfaces/IBLS.sol [Line: 24](src/interfaces/IBLS.sol#L24)

  ```solidity
          uint256[4] calldata pubkey,
  ```

- Found in src/interfaces/IBLS.sol [Line: 44](src/interfaces/IBLS.sol#L44)

  ```solidity
          uint256[4] calldata pubkeyG2
  ```

</details>

## L-5: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each
index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three
fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly
of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details><summary>6 Found Instances</summary>

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 29](src/adapters/EOFeedRegistryAdapterBase.sol#L29)

  ```solidity
      event FeedAdapterDeployed(uint256 indexed feedId, address indexed feedAdapter, address base, address quote);
  ```

- Found in src/interfaces/IEOFeedManager.sol [Line: 25](src/interfaces/IEOFeedManager.sol#L25)

  ```solidity
      event RateUpdated(uint256 indexed feedId, uint256 rate, uint256 timestamp);
  ```

- Found in src/interfaces/IEOFeedManager.sol [Line: 34](src/interfaces/IEOFeedManager.sol#L34)

  ```solidity
      event SymbolReplay(uint256 indexed feedId, uint256 rate, uint256 timestamp, uint256 latestTimestamp);
  ```

- Found in src/interfaces/IEOFeedVerifier.sol [Line: 59](src/interfaces/IEOFeedVerifier.sol#L59)

  ```solidity
      event ValidatorSetUpdated(
  ```

- Found in src/interfaces/IEOFeedVerifier.sol [Line: 67](src/interfaces/IEOFeedVerifier.sol#L67)

  ```solidity
      event FeedManagerSet(address feedManager);
  ```

- Found in src/interfaces/IEOTwitterFeedManager.sol [Line: 73](src/interfaces/IEOTwitterFeedManager.sol#L73)

  ```solidity
      event FeedPostUpdated(uint256 indexed feedId, uint64 indexed postId, Post post);
  ```

</details>

## L-6: Modifiers invoked only once can be shoe-horned into the function

<details><summary>4 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 59](src/EOFeedManager.sol#L59)

  ```solidity
      modifier onlyPauser() {
  ```

- Found in src/EOFeedManager.sol [Line: 64](src/EOFeedManager.sol#L64)

  ```solidity
      modifier onlyUnpauser() {
  ```

- Found in src/EOFeedManager.sol [Line: 69](src/EOFeedManager.sol#L69)

  ```solidity
      modifier onlyFeedDeployer() {
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 36](src/adapters/EOFeedRegistryAdapterBase.sol#L36)

  ```solidity
      modifier onlyFeedDeployer() {
  ```

</details>

## L-7: Large literal values multiples of 10000 can be replaced with scientific notation

Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>1 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 718](src/common/BLS.sol#L718)

  ```solidity
      uint256 internal constant PAIRING_EQUALITY_CHECK_GAS = 120_000;
  ```

</details>

## L-8: Internal functions called only once can be inlined

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This
can reduce the number of function calls and improve readability.

<details><summary>3 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 929](src/common/BLS.sol#L929)

  ```solidity
      function hashToField(bytes32 domain, bytes memory messages) internal pure returns (uint256[2] memory) {
  ```

- Found in src/common/BLS.sol [Line: 957](src/common/BLS.sol#L957)

  ```solidity
      function expandMsgTo96(bytes32 domain, bytes memory message) internal pure returns (bytes memory) {
  ```

- Found in src/common/BLS.sol [Line: 1131](src/common/BLS.sol#L1131)

  ```solidity
      function inverse(uint256 a) internal pure returns (uint256) {
  ```

</details>

## L-9: Unused Custom Error

it is recommended that the definition be removed when custom error is unused

<details><summary>2 Found Instances</summary>

- Found in src/interfaces/Errors.sol [Line: 22](src/interfaces/Errors.sol#L22)

  ```solidity
  error AggVotingPowerIsZero();
  ```

- Found in src/interfaces/Errors.sol [Line: 28](src/interfaces/Errors.sol#L28)

  ```solidity
  error SenderNotAllowed(address sender);
  ```

</details>

## L-10: Potentially unused `private` / `internal` state variables found.

State variable appears to be unused. No analysis has been performed to see if any inilne assembly references it. So if
that's not the case, consider removing this unused variable.

<details><summary>7 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 299](src/EOFeedManager.sol#L299)

  ```solidity
      uint256[50] private __gap;
  ```

- Found in src/EOFeedVerifier.sol [Line: 355](src/EOFeedVerifier.sol#L355)

  ```solidity
      uint256[50] private __gap;
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 222](src/EOTwitterFeedManager.sol#L222)

  ```solidity
      uint256[50] private __gap;
  ```

- Found in src/adapters/EOFeedAdapter.sol [Line: 205](src/adapters/EOFeedAdapter.sol#L205)

  ```solidity
      uint256[50] private __gap;
  ```

- Found in src/adapters/EOFeedAdapterV2.sol [Line: 197](src/adapters/EOFeedAdapterV2.sol#L197)

  ```solidity
      uint256[50] private __gap;
  ```

- Found in src/common/BLS.sol [Line: 747](src/common/BLS.sol#L747)

  ```solidity
      uint256 internal constant T24 = 0x1000000000000000000000000000000000000000000000000;
  ```

- Found in src/common/BLS.sol [Line: 748](src/common/BLS.sol#L748)

  ```solidity
      uint256 internal constant MASK24 = 0xffffffffffffffffffffffffffffffffffffffffffffffff;
  ```

</details>

## L-11: Uninitialized local variables.

Initialize all the variables. If a variable is meant to be initialized to zero, explicitly set it to zero to improve
code readability.

<details><summary>1 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 910](src/common/BLS.sol#L910)

  ```solidity
          uint256[1] memory out;
  ```

</details>

## L-12: Costly operations inside loops.

Invoking `SSTORE`operations in loops may lead to Out-of-gas errors. Use a local variable to hold the loop computation
result.

<details><summary>9 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 129](src/EOFeedManager.sol#L129)

  ```solidity
          for (uint256 i = 0; i < feedIds.length; i++) {
  ```

- Found in src/EOFeedManager.sol [Line: 139](src/EOFeedManager.sol#L139)

  ```solidity
          for (uint256 i = 0; i < feedIds.length; i++) {
  ```

- Found in src/EOFeedManager.sol [Line: 149](src/EOFeedManager.sol#L149)

  ```solidity
          for (uint256 i = 0; i < publishers.length; i++) {
  ```

- Found in src/EOFeedManager.sol [Line: 188](src/EOFeedManager.sol#L188)

  ```solidity
          for (uint256 i = 0; i < data.length; i++) {
  ```

- Found in src/EOFeedVerifier.sol [Line: 131](src/EOFeedVerifier.sol#L131)

  ```solidity
              for (uint256 i = length; i < _currentValidatorSetLength; i++) {
  ```

- Found in src/EOFeedVerifier.sol [Line: 142](src/EOFeedVerifier.sol#L142)

  ```solidity
          for (uint256 i = 0; i < length; i++) {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 74](src/EOTwitterFeedManager.sol#L74)

  ```solidity
          for (uint256 i = 0; i < feedIds.length; i++) {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 84](src/EOTwitterFeedManager.sol#L84)

  ```solidity
          for (uint256 i = 0; i < publishers.length; i++) {
  ```

- Found in src/EOTwitterFeedManager.sol [Line: 121](src/EOTwitterFeedManager.sol#L121)

  ```solidity
          for (uint256 i = 0; i < data.length; i++) {
  ```

</details>
